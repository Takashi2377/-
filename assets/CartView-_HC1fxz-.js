import{_ as M,a as k,r as f,o as h,c as m,d as i,b as t,F as I,i as E,n as b,t as p,j as v,v as L,w as U,q as $,e as V,s as y}from"./index-UV12MeIp.js";import{u as w}from"./toastMessage-YhLv_bF_.js";var T={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"yuetin-hexschool",BASE_URL:"/FinalMission-Edtion1/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:d,VITE_PATH:r}=T,q={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{...k(w,["pushMessage"]),getProducts(){const o=`${d}/api/${r}/products`;this.isLoading=!0,this.$http.get(o).then(s=>{this.products=s.data.products,this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得產品資訊失敗",content:s.response.data.message})})},getProduct(o){this.$router.push(`product/${o}`)},addToCart(o,s=1){this.isLoading=!0;const l=`${d}/api/${r}/cart`;this.status.loadingItem=o;const u={product_id:o,qty:s};this.$http.post(l,{data:u}).then(e=>{this.status.loadingItem="",this.isLoading=!1,this.pushMessage({style:"success",title:"成功加入購物車",content:e.data.message}),this.getCart()}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入購物車失敗",content:e.response.data.message})})},deleteAllCarts(){this.isLoading=!0;const o=`${d}/api/${r}/carts`;this.$http.delete(o).then(s=>{this.pushMessage({style:"success",title:"清除購物車",content:s.data.message}),this.getCart(),this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"清除購物車",content:s.response.data.message})})},getCart(){const o=`${d}/api/${r}/cart`;this.isLoading=!0,this.$http.get(o).then(s=>{console.log(s),this.cart=s.data.data,this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得購物車資訊",content:s.response.data.message})})},removeCartItem(o){this.status.loadingItem=o;const s=`${d}/api/${r}/cart/${o}`;this.isLoading=!0,this.$http.delete(s).then(l=>{this.pushMessage({style:"success",title:"移除購物車品項",content:l.data.message}),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"移除購物車品項",content:l.response.data.message})})},updateCart(o){this.isLoading=!0;const s=`${d}/api/${r}/cart/${o.id}`,l={product_id:o.product_id,qty:o.qty};this.$http.put(s,{data:l}).then(u=>{this.pushMessage({style:"success",title:"更新購物車",content:u.data.message}),this.isLoading=!1,this.getCart()}).catch(u=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新購物車",content:u.response.data.message})})},addCouponCode(){const o=`${d}/api/${r}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.$http.post(o,{data:s}).then(l=>{this.pushMessage({style:"success",title:"加入優惠券",content:l.data.message}),this.getCart(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:l.response.data.message})})},createOrder(){this.isLoading=!0;const o=`${d}/api/${r}/order`,s=this.form;this.$http.post(o,{data:s}).then(l=>{this.$router.push(`checkout/${l.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:l.response.data.message})})}},created(){this.getProducts(),this.getCart()}},F={class:"container"},S={class:"mt-4"},A={class:"text-end"},B={class:"table align-middle"},P=t("thead",null,[t("tr",null,[t("th",{style:{width:"110px"}}),t("th",null,"圖片"),t("th",null,"品名"),t("th",{style:{width:"110px"}},"數量"),t("th",{class:"text-center"},"單價")])],-1),D=["disabled","onClick"],R=t("i",{class:"bi bi-x"},null,-1),z=[R],N={style:{width:"200px"}},O={style:{width:"300px"}},j={key:0,class:"text-success"},H={class:"input-group input-group-sm"},G=["onUpdate:modelValue","onBlur"],J={class:"input-group-text"},K={class:"text-end"},Q={key:0,class:"text-success"},W=t("td",{colspan:"4",class:"text-end"},"總計",-1),X={class:"text-end"},Y={key:0},Z=t("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),tt={class:"text-end text-success"},st={class:"input-group mb-3 input-group-sm"},et={class:"input-group-append"},ot={class:"my-5 row justify-content-center"},at={class:"mb-3"},lt=t("label",{for:"email",class:"form-label"},"Email",-1),nt={class:"mb-3"},it=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),dt={class:"mb-3"},rt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),ct={class:"mb-3"},ut=t("label",{for:"address",class:"form-label"},"收件人地址",-1),ht={class:"mb-3"},mt=t("label",{for:"message",class:"form-label"},"留言",-1),pt=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function gt(o,s,l,u,e,c){const x=f("VueLoading"),g=f("VeeField"),_=f("ErrorMessage"),C=f("VeeForm");return h(),m("div",F,[i(x,{active:e.isLoading,"z-index":1060},null,8,["active"]),t("div",S,[t("div",A,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...a)=>c.deleteAllCarts&&c.deleteAllCarts(...a))}," 清空購物車 ")]),t("table",B,[P,t("tbody",null,[e.cart.carts?(h(!0),m(I,{key:0},E(e.cart.carts,a=>(h(),m("tr",{key:a.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:e.status.loadingItem===a.id,onClick:n=>c.removeCartItem(a.id)},z,8,D)]),t("td",N,[t("div",{style:$([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${a.product.imageUrl})`}])},null,4)]),t("td",O,[V(p(a.product.title)+" ",1),a.coupon?(h(),m("div",j,"已套用優惠券")):b("",!0)]),t("td",null,[t("div",H,[v(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":n=>a.qty=n,onBlur:n=>c.updateCart(a)},null,40,G),[[L,a.qty,void 0,{number:!0}]]),t("div",J,"/ "+p(a.product.unit),1)])]),t("td",K,[e.cart.final_total!==e.cart.total?(h(),m("small",Q,"折扣價：")):b("",!0),V(" "+p(o.$filters.currency(a.final_total)),1)])]))),128)):b("",!0)]),t("tfoot",null,[t("tr",null,[W,t("td",X,p(o.$filters.currency(e.cart.total)),1)]),e.cart.final_total!==e.cart.total?(h(),m("tr",Y,[Z,t("td",tt,p(o.$filters.currency(e.cart.final_total)),1)])):b("",!0)])]),t("div",st,[v(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=a=>e.coupon_code=a),placeholder:"輸入優惠碼 'FB777' ，即享線上首購優惠77折"},null,512),[[L,e.coupon_code]]),t("div",et,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[2]||(s[2]=(...a)=>c.addCouponCode&&c.addCouponCode(...a))}," 套用優惠碼 ")])])]),t("div",ot,[i(C,{ref:"form",class:"col-md-6",onSubmit:c.createOrder},{default:U(({errors:a})=>[t("div",at,[lt,i(g,{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=n=>e.form.user.email=n)},null,8,["class","modelValue"]),i(_,{name:"email",class:"invalid-feedback"})]),t("div",nt,[it,i(g,{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=n=>e.form.user.name=n)},null,8,["class","modelValue"]),i(_,{name:"姓名",class:"invalid-feedback"})]),t("div",dt,[rt,i(g,{id:"tel",name:"電話",type:"tel",class:y(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:e.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=n=>e.form.user.tel=n)},null,8,["class","modelValue"]),i(_,{name:"電話",class:"invalid-feedback"})]),t("div",ct,[ut,i(g,{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=n=>e.form.user.address=n)},null,8,["class","modelValue"]),i(_,{name:"地址",class:"invalid-feedback"})]),t("div",ht,[mt,v(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=n=>e.form.message=n)},null,512),[[L,e.form.message]])]),pt]),_:1},8,["onSubmit"])])])}const bt=M(q,[["render",gt]]);export{bt as default};
